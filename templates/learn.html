{% extends "layout.html" %}
{% block content %}
<div class="learn-nav">
  <a class="btn learn-btn" href="{{ url_for('learn') }}">Learn</a>
  <a class="btn quiz-btn" href="{{ url_for('quiz') }}">Skip to Quiz</a>
</div>

<section class="learn-slide" id="intro-slide">
  <h1><em>What is</em> the Offside Rule?</h1>
  <div class="text-columns">
    <div class="column">
      <h3>What is the Offside Rule even for?</h3>
      <p>If you’ve ever watched a football match, you’ve probably heard the term “offside” thrown around, often followed by some groans, cheers, or VAR jokes (a system that uses video footage to assist on-field referees in making decisions).</p>
    </div>
    <div class="column">
      <h3>Why?</h3>
      <p>In simple terms, the offside rule exists to prevent players from hanging around the opponent’s goal waiting for an easy chance to score. It keeps the game fair and strategic. It can get a bit technical, which is why even VAR (Video Assistant Referee) sometimes takes ages to decide.</p>
    </div>
  </div>
  <div class="speech-bubbles">
    <div class="bubble green">“VAR works for [ rival team ] confirmed.”</div>
    <div class="bubble white">“By the time VAR makes a decision, I’ll be at the World Cup.”</div>
  </div>
  <a class="big-arrow" href="#match-section">VIEW A MATCH</a>
</section>

<br><br><br>
<div class="checkerboard"></div>
<br><br><br><br><br><br>

<!-- Slide 0: just setup sentence -->
<section id="match-section" class="match-slide">
  <div class="slide-content">
    <div class="slide-text">
      <h1><em>What is</em> the Offside Rule?</h1>
      <p>A player is in an <strong>offside position</strong> if, at the moment the ball is played to them:</p>
      <ul></ul>
      <div class="next-button" onclick="showSlide(1)">SEE RULE</div>
    </div>
    <div class="slide-image">
      <img src="{{ url_for('static', filename='pdf_images/base_learning.png') }}" class="match-image show" alt="Slide 0">
      <img class="match-image overlay" alt="Crossfade">
    </div>
  </div>
</section>

<!-- Slide 1 -->
<section class="match-slide" style="display:none;">
  <div class="slide-content">
    <div class="slide-text">
      <h1><em>What is</em> the Offside Rule?</h1>
      <p>A player is in an <strong>offside position</strong> if, at the moment the ball is played to them:</p>
      <ul>
        <li><strong>1.</strong> They are <strong>closer to the opponent’s goal line</strong> than both the ball <em>and</em> the <strong>second-to-last defender</strong>.</li>
      </ul>
      <div class="next-button" onclick="showSlide(2)">SEE RULE</div>
    </div>
    <div class="slide-image">
      <img src="{{ url_for('static', filename='pdf_images/base_2.png') }}" class="match-image show" alt="Slide 1">
      <img class="match-image overlay" alt="Crossfade">
    </div>
  </div>
</section>

<!-- Slide 2 -->
<section class="match-slide" style="display:none;">
  <div class="slide-content">
    <div class="slide-text">
      <h1><em>What is</em> the Offside Rule?</h1>
      <p>A player is in an <strong>offside position</strong> if, at the moment the ball is played to them:</p>
      <ul>
        <li><strong>1.</strong> They are <strong>closer to the opponent’s goal line</strong> than both the ball <em>and</em> the <strong>second-to-last defender</strong>.</li>
        <li><strong>2.</strong> They are <strong>actively involved in play</strong> (e.g., receiving the ball or interfering with play).</li>
      </ul>
      <div class="next-button" onclick="showSlide(3)">SEE RULE</div>
    </div>
    <div class="slide-image">
      <img src="{{ url_for('static', filename='pdf_images/base_3.png') }}" class="match-image show" alt="Slide 2">
      <img class="match-image overlay" alt="Crossfade">
    </div>
  </div>
</section>

<!-- Slide 3 -->
<section class="match-slide" style="display:none;">
  <div class="slide-content">
    <div class="slide-text">
      <h1><em>What is</em> the Offside Rule?</h1>
      <p>A player is in an <strong>offside position</strong> if, at the moment the ball is played to them:</p>
      <ul>
        <li><strong>1.</strong> They are <strong>closer to the opponent’s goal line</strong> than both the ball <em>and</em> the <strong>second-to-last defender</strong>.</li>
        <li><strong>2.</strong> They are <strong>actively involved in play</strong> (e.g., receiving the ball or interfering with play).</li>
        <li><strong>3.</strong> They are in the <strong>opponent’s half of the field</strong>.</li>
      </ul>
      <div class="next-button" onclick="window.location.href='/quiz'">START QUIZ</div>
    </div>
    <div class="slide-image">
      <img src="{{ url_for('static', filename='pdf_images/base_4.png') }}" class="match-image show" alt="Slide 3">
      <img class="match-image overlay" alt="Crossfade">
    </div>
  </div>
</section>

<br><br><br><br><br><br>
<div class="checkerboard"></div>

<script>
function showSlide(index) {
  const slides = document.querySelectorAll(".match-slide");
  const current = document.querySelector(".match-slide:not([style*='display: none'])");
  const next = slides[index];

  if (!current || !next || current === next) return;

  // Get the current timestamp
  const timestamp = new Date().toISOString();

  // Send the slide log to the server
  fetch("/log_slide", {
    method: "POST",
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      slide: index,
      time: timestamp
    })
  });

  // Animate transition
  const currentOverlay = current.querySelector(".match-image.overlay");
  const nextImage = next.querySelector(".match-image.show");

  currentOverlay.src = nextImage.src;
  currentOverlay.classList.add("show");

  setTimeout(() => {
    currentOverlay.classList.remove("show");
    current.style.display = "none";
    next.style.display = "block";
  }, 600);
}
</script>
{% endblock %}
